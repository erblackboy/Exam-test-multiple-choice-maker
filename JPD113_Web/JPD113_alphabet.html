<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc B·∫£ng Ch·ªØ C√°i Ti·∫øng Nh·∫≠t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #game-layout.hint-active #game-area {
            grid-column: span 2 / span 2;
        }
        #hint-panel {
            transition: all 0.3s ease-in-out;
        }
        /* Styles for Matching Game */
        .match-card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .match-card.selected {
            transform: scale(1.05);
            background-color: #6366f1 !important; /* indigo-500 */
            color: white;
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.1);
        }
        .match-card.matched {
            background-color: #4ade80 !important; /* green-400 */
            color: white;
            cursor: default;
            opacity: 0.7;
        }
        .match-card.wrong {
            animation: shake 0.5s;
            background-color: #f87171 !important; /* red-400 */
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        /* Override m·ªôt v√†i style c·ªßa main.css ƒë·ªÉ ph√π h·ª£p v·ªõi trang game */
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .game-wrapper {
             width: 100%;
             max-width: 1100px;
             margin: 20px;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="game-wrapper">
        <div class="mb-4">
             <nav class="breadcrumb" style="background: none; padding: 0; box-shadow: none;">
                <a href="../index.html">Trang ch·ªß</a> &gt; 
                <a href="index.html">JPD113</a> &gt; B·∫£ng ch·ªØ c√°i
            </nav>
        </div>
        
        <div id="app-container" class="w-full">
            <div id="main-menu" class="text-center bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-3xl md:text-4xl font-bold mb-2 text-indigo-600">H·ªçc B·∫£ng Ch·ªØ C√°i Ti·∫øng Nh·∫≠t</h1>
                <p class="text-slate-500 mb-8">Ch·ªçn m·ªôt b·∫£ng ch·ªØ c√°i v√† ch·∫ø ƒë·ªô ch∆°i ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-slate-50 p-6 rounded-lg">
                        <h2 class="text-2xl font-bold mb-4">„Å≤„Çâ„Åå„Å™ (Hiragana)</h2>
                        <div class="flex flex-col space-y-3">
                            <button onclick="startGame('hiragana', 'multipleChoice')" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                Tr·∫Øc nghi·ªám (Ch·ªçn 1 trong 4)
                            </button>
                            <button onclick="startGame('hiragana', 'matching')" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                Gh√©p th·∫ª (5 c·∫∑p)
                            </button>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-lg">
                        <h2 class="text-2xl font-bold mb-4">„Ç´„Çø„Ç´„Éä (Katakana)</h2>
                        <div class="flex flex-col space-y-3">
                            <button onclick="startGame('katakana', 'multipleChoice')" class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                Tr·∫Øc nghi·ªám (Ch·ªçn 1 trong 4)
                            </button>
                            <button onclick="startGame('katakana', 'matching')" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                                Gh√©p th·∫ª (5 c·∫∑p)
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-8 border-t pt-6">
                    <h2 class="text-2xl font-bold mb-4 text-orange-600">Êº¢Â≠ó (Kanji)</h2>
                    <div class="max-w-sm mx-auto">
                         <button onclick="location.href='Kanji_list.html'" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                            üìú Xem Danh s√°ch Kanji
                        </button>
                    </div>
                </div>
                
            </div>

            <div id="game-container" class="hidden w-full">
                <div class="relative">
                     <button id="back-to-menu" class="absolute top-0 left-0 bg-slate-200 hover:bg-slate-300 text-slate-600 font-bold py-2 px-4 rounded-lg transition duration-300 z-20">
                        &larr; Quay l·∫°i
                    </button>
                    <button id="hint-button" class="absolute top-0 right-0 bg-yellow-400 hover:bg-yellow-500 text-white p-3 rounded-full shadow-md transition duration-300 z-20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                        </svg>
                    </button>
                </div>
               
                <div id="game-layout" class="grid grid-cols-3 gap-6 mt-16">
                    <div id="game-area" class="col-span-3 transition-all duration-300 ease-in-out">
                        <div class="bg-white p-6 rounded-xl shadow-lg w-full h-full flex flex-col justify-between">
                            <div>
                                <div class="flex justify-between items-center mb-4">
                                    <h2 id="game-title" class="text-2xl font-bold text-indigo-600"></h2>
                                    <p class="text-lg font-semibold">ƒêi·ªÉm: <span id="score">0</span></p>
                                </div>
                                <div id="question-area" class="text-center mb-6 min-h-[150px] flex items-center justify-center">
                                    </div>
                            </div>
                            <div id="options-area" class="w-full">
                                </div>
                            <div id="feedback-area" class="text-center mt-4 h-8 text-xl font-bold"></div>
                        </div>
                    </div>

                    <div id="hint-panel" class="hidden bg-white p-6 rounded-xl shadow-lg overflow-y-auto max-h-[80vh]">
                        <h3 id="hint-title" class="text-xl font-bold mb-4 text-center"></h3>
                        <div id="hint-chart" class="space-y-6">
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- D·ªÆ LI·ªÜU B·∫¢NG CH·ªÆ C√ÅI ---
        const HIRAGANA_DATA = [
            { kana: '„ÅÇ', romaji: 'a' }, { kana: '„ÅÑ', romaji: 'i' }, { kana: '„ÅÜ', romaji: 'u' }, { kana: '„Åà', romaji: 'e' }, { kana: '„Åä', romaji: 'o' },
            { kana: '„Åã', romaji: 'ka' }, { kana: '„Åç', romaji: 'ki' }, { kana: '„Åè', romaji: 'ku' }, { kana: '„Åë', romaji: 'ke' }, { kana: '„Åì', romaji: 'ko' },
            { kana: '„Åï', romaji: 'sa' }, { kana: '„Åó', romaji: 'shi' }, { kana: '„Åô', romaji: 'su' }, { kana: '„Åõ', romaji: 'se' }, { kana: '„Åù', romaji: 'so' },
            { kana: '„Åü', romaji: 'ta' }, { kana: '„Å°', romaji: 'chi' }, { kana: '„Å§', romaji: 'tsu' }, { kana: '„Å¶', romaji: 'te' }, { kana: '„Å®', romaji: 'to' },
            { kana: '„Å™', romaji: 'na' }, { kana: '„Å´', romaji: 'ni' }, { kana: '„Å¨', romaji: 'nu' }, { kana: '„Å≠', romaji: 'ne' }, { kana: '„ÅÆ', romaji: 'no' },
            { kana: '„ÅØ', romaji: 'ha' }, { kana: '„Å≤', romaji: 'hi' }, { kana: '„Åµ', romaji: 'fu' }, { kana: '„Å∏', romaji: 'he' }, { kana: '„Åª', romaji: 'ho' },
            { kana: '„Åæ', romaji: 'ma' }, { kana: '„Åø', romaji: 'mi' }, { kana: '„ÇÄ', romaji: 'mu' }, { kana: '„ÇÅ', romaji: 'me' }, { kana: '„ÇÇ', romaji: 'mo' },
            { kana: '„ÇÑ', romaji: 'ya' }, { kana: '„ÇÜ', romaji: 'yu' }, { kana: '„Çà', romaji: 'yo' },
            { kana: '„Çâ', romaji: 'ra' }, { kana: '„Çä', romaji: 'ri' }, { kana: '„Çã', romaji: 'ru' }, { kana: '„Çå', romaji: 're' }, { kana: '„Çç', romaji: 'ro' },
            { kana: '„Çè', romaji: 'wa' }, { kana: '„Çí', romaji: 'wo' },
            { kana: '„Çì', romaji: 'n' },
            { kana: '„Åå', romaji: 'ga' }, { kana: '„Åé', romaji: 'gi' }, { kana: '„Åê', romaji: 'gu' }, { kana: '„Åí', romaji: 'ge' }, { kana: '„Åî', romaji: 'go' },
            { kana: '„Åñ', romaji: 'za' }, { kana: '„Åò', romaji: 'ji' }, { kana: '„Åö', romaji: 'zu' }, { kana: '„Åú', romaji: 'ze' }, { kana: '„Åû', romaji: 'zo' },
            { kana: '„Å†', romaji: 'da' }, { kana: '„Å¢', romaji: 'ji' }, { kana: '„Å•', romaji: 'zu' }, { kana: '„Åß', romaji: 'de' }, { kana: '„Å©', romaji: 'do' },
            { kana: '„Å∞', romaji: 'ba' }, { kana: '„Å≥', romaji: 'bi' }, { kana: '„Å∂', romaji: 'bu' }, { kana: '„Åπ', romaji: 'be' }, { kana: '„Åº', romaji: 'bo' },
            { kana: '„Å±', romaji: 'pa' }, { kana: '„Å¥', romaji: 'pi' }, { kana: '„Å∑', romaji: 'pu' }, { kana: '„Å∫', romaji: 'pe' }, { kana: '„ÅΩ', romaji: 'po' }
        ];

        const KATAKANA_DATA = [
            { kana: '„Ç¢', romaji: 'a' }, { kana: '„Ç§', romaji: 'i' }, { kana: '„Ç¶', romaji: 'u' }, { kana: '„Ç®', romaji: 'e' }, { kana: '„Ç™', romaji: 'o' },
            { kana: '„Ç´', romaji: 'ka' }, { kana: '„Ç≠', romaji: 'ki' }, { kana: '„ÇØ', romaji: 'ku' }, { kana: '„Ç±', romaji: 'ke' }, { kana: '„Ç≥', romaji: 'ko' },
            { kana: '„Çµ', romaji: 'sa' }, { kana: '„Ç∑', romaji: 'shi' }, { kana: '„Çπ', romaji: 'su' }, { kana: '„Çª', romaji: 'se' }, { kana: '„ÇΩ', romaji: 'so' },
            { kana: '„Çø', romaji: 'ta' }, { kana: '„ÉÅ', romaji: 'chi' }, { kana: '„ÉÑ', romaji: 'tsu' }, { kana: '„ÉÜ', romaji: 'te' }, { kana: '„Éà', romaji: 'to' },
            { kana: '„Éä', romaji: 'na' }, { kana: '„Éã', romaji: 'ni' }, { kana: '„Éå', romaji: 'nu' }, { kana: '„Éç', romaji: 'ne' }, { kana: '„Éé', romaji: 'no' },
            { kana: '„Éè', romaji: 'ha' }, { kana: '„Éí', romaji: 'hi' }, { kana: '„Éï', romaji: 'fu' }, { kana: '„Éò', romaji: 'he' }, { kana: '„Éõ', romaji: 'ho' },
            { kana: '„Éû', romaji: 'ma' }, { kana: '„Éü', romaji: 'mi' }, { kana: '„É†', romaji: 'mu' }, { kana: '„É°', romaji: 'me' }, { kana: '„É¢', romaji: 'mo' },
            { kana: '„É§', romaji: 'ya' }, { kana: '„É¶', romaji: 'yu' }, { kana: '„É®', romaji: 'yo' },
            { kana: '„É©', romaji: 'ra' }, { kana: '„É™', romaji: 'ri' }, { kana: '„É´', romaji: 'ru' }, { kana: '„É¨', romaji: 're' }, { kana: '„É≠', romaji: 'ro' },
            { kana: '„ÉØ', romaji: 'wa' }, { kana: '„É≤', romaji: 'wo' },
            { kana: '„É≥', romaji: 'n' },
            { kana: '„Ç¨', romaji: 'ga' }, { kana: '„ÇÆ', romaji: 'gi' }, { kana: '„Ç∞', romaji: 'gu' }, { kana: '„Ç≤', romaji: 'ge' }, { kana: '„Ç¥', romaji: 'go' },
            { kana: '„Ç∂', romaji: 'za' }, { kana: '„Ç∏', romaji: 'ji' }, { kana: '„Ç∫', romaji: 'zu' }, { kana: '„Çº', romaji: 'ze' }, { kana: '„Çæ', romaji: 'zo' },
            { kana: '„ÉÄ', romaji: 'da' }, { kana: '„ÉÇ', romaji: 'ji' }, { kana: '„ÉÖ', romaji: 'zu' }, { kana: '„Éá', romaji: 'de' }, { kana: '„Éâ', romaji: 'do' },
            { kana: '„Éê', romaji: 'ba' }, { kana: '„Éì', romaji: 'bi' }, { kana: '„Éñ', romaji: 'bu' }, { kana: '„Éô', romaji: 'be' }, { kana: '„Éú', romaji: 'bo' },
            { kana: '„Éë', romaji: 'pa' }, { kana: '„Éî', romaji: 'pi' }, { kana: '„Éó', romaji: 'pu' }, { kana: '„Éö', romaji: 'pe' }, { kana: '„Éù', romaji: 'po' }
        ];

        // --- C·∫§U TR√öC B·∫¢NG CH·ªÆ C√ÅI CHO HINT PANEL ---
        const GOJUON_LAYOUT = {
            hiragana: {
                main: [
                    ['„ÅÇ', '„ÅÑ', '„ÅÜ', '„Åà', '„Åä'],
                    ['„Åã', '„Åç', '„Åè', '„Åë', '„Åì'],
                    ['„Åï', '„Åó', '„Åô', '„Åõ', '„Åù'],
                    ['„Åü', '„Å°', '„Å§', '„Å¶', '„Å®'],
                    ['„Å™', '„Å´', '„Å¨', '„Å≠', '„ÅÆ'],
                    ['„ÅØ', '„Å≤', '„Åµ', '„Å∏', '„Åª'],
                    ['„Åæ', '„Åø', '„ÇÄ', '„ÇÅ', '„ÇÇ'],
                    ['„ÇÑ', '', '„ÇÜ', '', '„Çà'],
                    ['„Çâ', '„Çä', '„Çã', '„Çå', '„Çç'],
                    ['„Çè', '', '„Çí', '', ''],
                    ['„Çì', '', '', '', '']
                ],
                dakuten: [
                    ['„Åå', '„Åé', '„Åê', '„Åí', '„Åî'],
                    ['„Åñ', '„Åò', '„Åö', '„Åú', '„Åû'],
                    ['„Å†', '„Å¢', '„Å•', '„Åß', '„Å©'],
                    ['„Å∞', '„Å≥', '„Å∂', '„Åπ', '„Åº']
                ],
                handakuten: [
                    ['„Å±', '„Å¥', '„Å∑', '„Å∫', '„ÅΩ']
                ]
            },
            katakana: {
                main: [
                    ['„Ç¢', '„Ç§', '„Ç¶', '„Ç®', '„Ç™'],
                    ['„Ç´', '„Ç≠', '„ÇØ', '„Ç±', '„Ç≥'],
                    ['„Çµ', '„Ç∑', '„Çπ', '„Çª', '„ÇΩ'],
                    ['„Çø', '„ÉÅ', '„ÉÑ', '„ÉÜ', '„Éà'],
                    ['„Éä', '„Éã', '„Éå', '„Éç', '„Éé'],
                    ['„Éè', '„Éí', '„Éï', '„Éò', '„Éõ'],
                    ['„Éû', '„Éü', '„É†', '„É°', '„É¢'],
                    ['„É§', '', '„É¶', '', '„É®'],
                    ['„É©', '„É™', '„É´', '„É¨', '„É≠'],
                    ['„ÉØ', '', '„É≤', '', ''],
                    ['„É≥', '', '', '', '']
                ],
                dakuten: [
                    ['„Ç¨', '„ÇÆ', '„Ç∞', '„Ç≤', '„Ç¥'],
                    ['„Ç∂', '„Ç∏', '„Ç∫', '„Çº', '„Çæ'],
                    ['„ÉÄ', '„ÉÇ', '„ÉÖ', '„Éá', '„Éâ'],
                    ['„Éê', '„Éì', '„Éñ', '„Éô', '„Éú']
                ],
                handakuten: [
                    ['„Éë', '„Éî', '„Éó', '„Éö', '„Éù']
                ]
            }
        };

        // --- BI·∫æN TR·∫†NG TH√ÅI GAME ---
        let currentSyllabaryData = [];
        let currentSyllabaryName = '';
        let currentGameMode = '';
        let score = 0;
        let currentQuestionData = {};
        let matchedPairs = 0;
        let selectedCard = null;
        let lockGame = false;

        // --- DOM ELEMENTS ---
        const mainMenu = document.getElementById('main-menu');
        const gameContainer = document.getElementById('game-container');
        const gameLayout = document.getElementById('game-layout');
        const gameArea = document.getElementById('game-area');
        const hintPanel = document.getElementById('hint-panel');
        const hintButton = document.getElementById('hint-button');
        const backButton = document.getElementById('back-to-menu');
        const scoreDisplay = document.getElementById('score');
        const gameTitle = document.getElementById('game-title');
        const questionArea = document.getElementById('question-area');
        const optionsArea = document.getElementById('options-area');
        const feedbackArea = document.getElementById('feedback-area');
        const hintTitle = document.getElementById('hint-title');
        const hintChart = document.getElementById('hint-chart');

        // --- H√ÄM TI·ªÜN √çCH ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- H√ÄM QU·∫¢N L√ù GAME ---
        function startGame(syllabary, mode) {
            mainMenu.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            currentSyllabaryName = syllabary;
            currentGameMode = mode;
            currentSyllabaryData = syllabary === 'hiragana' ? HIRAGANA_DATA : KATAKANA_DATA;
            
            score = 0;
            scoreDisplay.textContent = score;
            feedbackArea.textContent = '';
            closeHint();

            if (mode === 'multipleChoice') {
                gameTitle.textContent = `Tr·∫Øc nghi·ªám ${syllabary === 'hiragana' ? 'Hiragana' : 'Katakana'}`;
                setupMultipleChoice();
            } else if (mode === 'matching') {
                gameTitle.textContent = `Gh√©p th·∫ª ${syllabary === 'hiragana' ? 'Hiragana' : 'Katakana'}`;
                setupMatchingGame();
            }
        }

        function backToMenu() {
            gameContainer.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            closeHint();
        }

        function updateScore(points) {
            score += points;
            scoreDisplay.textContent = score;
        }

        function showFeedback(isCorrect, correctAnswer = null) {
            if (isCorrect) {
                feedbackArea.textContent = 'Ch√≠nh x√°c! üéâ';
                feedbackArea.className = 'text-center mt-4 h-8 text-2xl font-bold text-green-500';
            } else {
                feedbackArea.innerHTML = `Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√† <strong class="text-blue-600">${correctAnswer}</strong>`;
                feedbackArea.className = 'text-center mt-4 h-8 text-xl font-bold text-red-500';
            }
        }

        // --- CH·∫æ ƒê·ªò TR·∫ÆC NGHI·ªÜM ---
        function setupMultipleChoice() {
            lockGame = false;
            questionArea.innerHTML = '';
            optionsArea.innerHTML = '';
            feedbackArea.innerHTML = '';

            currentQuestionData = currentSyllabaryData[Math.floor(Math.random() * currentSyllabaryData.length)];
            
            const questionChar = document.createElement('div');
            questionChar.textContent = currentQuestionData.kana;
            questionChar.className = 'text-8xl md:text-9xl font-bold';
            questionArea.appendChild(questionChar);

            let options = [currentQuestionData.romaji];
            while (options.length < 4) {
                const randomOption = currentSyllabaryData[Math.floor(Math.random() * currentSyllabaryData.length)].romaji;
                if (!options.includes(randomOption)) {
                    options.push(randomOption);
                }
            }
            shuffleArray(options);

            const optionsGrid = document.createElement('div');
            optionsGrid.className = 'grid grid-cols-2 gap-4';
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-4 px-4 rounded-lg transition duration-300 text-2xl';
                button.onclick = () => checkMultipleChoiceAnswer(option);
                optionsGrid.appendChild(button);
            });
            optionsArea.appendChild(optionsGrid);
        }

        function checkMultipleChoiceAnswer(selectedRomaji) {
            if (lockGame) return;
            lockGame = true;
            const isCorrect = selectedRomaji === currentQuestionData.romaji;
            const optionButtons = optionsArea.querySelectorAll('button');

            showFeedback(isCorrect, currentQuestionData.romaji);

            if (isCorrect) {
                updateScore(10);
                for (const btn of optionButtons) {
                    if (btn.textContent === selectedRomaji) {
                        btn.classList.remove('bg-slate-200', 'hover:bg-slate-300');
                        btn.classList.add('bg-green-500', 'text-white');
                    }
                }
            } else {
                for (const btn of optionButtons) {
                    if (btn.textContent === selectedRomaji) {
                        // L·ª±a ch·ªçn sai c·ªßa ng∆∞·ªùi d√πng
                        btn.classList.remove('bg-slate-200', 'hover:bg-slate-300');
                        btn.classList.add('bg-red-500', 'text-white', 'opacity-70');
                    } else if (btn.textContent === currentQuestionData.romaji) {
                        // ƒê√°p √°n ƒë√∫ng
                        btn.classList.remove('bg-slate-200', 'hover:bg-slate-300');
                        btn.classList.add('bg-green-500', 'text-white');
                    }
                }
            }

            setTimeout(() => {
                lockGame = false;
                setupMultipleChoice();
            }, 2500); // TƒÉng th·ªùi gian ch·ªù ƒë·ªÉ ng∆∞·ªùi d√πng xem ƒë√°p √°n
        }

        // --- CH·∫æ ƒê·ªò GH√âP TH·∫∫ ---
        function setupMatchingGame() {
            questionArea.innerHTML = '<p class="text-xl text-slate-600">Ch·ªçn 1 th·∫ª ch·ªØ Nh·∫≠t v√† 1 th·∫ª phi√™n √¢m t∆∞∆°ng ·ª©ng.</p>';
            optionsArea.innerHTML = '';
            matchedPairs = 0;
            selectedCard = null;
            lockGame = false;
            
            const shuffledData = shuffleArray([...currentSyllabaryData]);
            const selectedPairs = shuffledData.slice(0, 5);
            
            let cards = [];
            selectedPairs.forEach(pair => {
                cards.push({ type: 'kana', value: pair.kana, pairId: pair.romaji });
                cards.push({ type: 'romaji', value: pair.romaji, pairId: pair.romaji });
            });
            shuffleArray(cards);

            const cardsGrid = document.createElement('div');
            cardsGrid.className = 'grid grid-cols-5 gap-3 md:gap-4';
            
            cards.forEach(cardData => {
                const cardElement = document.createElement('div');
                cardElement.className = 'match-card flex items-center justify-center bg-white rounded-lg shadow-md text-2xl md:text-3xl font-bold p-4 aspect-square';
                cardElement.textContent = cardData.value;
                cardElement.dataset.pairId = cardData.pairId;
                cardElement.dataset.type = cardData.type;
                cardElement.addEventListener('click', () => handleCardSelection(cardElement));
                cardsGrid.appendChild(cardElement);
            });
            optionsArea.appendChild(cardsGrid);
        }

        function handleCardSelection(clickedCard) {
            if (lockGame || clickedCard.classList.contains('matched') || clickedCard.classList.contains('selected')) {
                return;
            }
            clickedCard.classList.add('selected');
            if (!selectedCard) {
                selectedCard = clickedCard;
            } else {
                lockGame = true;
                if (selectedCard.dataset.pairId === clickedCard.dataset.pairId && selectedCard.dataset.type !== clickedCard.dataset.type) {
                    showFeedback(true);
                    updateScore(20);
                    selectedCard.classList.add('matched');
                    clickedCard.classList.add('matched');
                    selectedCard.classList.remove('selected');
                    clickedCard.classList.remove('selected');
                    matchedPairs++;
                    selectedCard = null;
                    lockGame = false;
                    if (matchedPairs === 5) {
                        setTimeout(() => {
                            feedbackArea.textContent = 'Ho√†n th√†nh! Gi·ªèi l·∫Øm! üèÜ';
                            feedbackArea.className = 'text-center mt-4 h-8 text-2xl font-bold text-blue-600';
                            setTimeout(setupMatchingGame, 2000);
                        }, 500);
                    }
                } else {
                    showFeedback(false);
                    selectedCard.classList.add('wrong');
                    clickedCard.classList.add('wrong');
                    setTimeout(() => {
                        selectedCard.classList.remove('selected', 'wrong');
                        clickedCard.classList.remove('selected', 'wrong');
                        selectedCard = null;
                        lockGame = false;
                    }, 800);
                }
            }
        }

        // --- H·ªÜ TH·ªêNG G·ª¢I √ù ---
        function toggleHint() {
            const isHidden = hintPanel.classList.contains('hidden');
            if (isHidden) {
                openHint();
            } else {
                closeHint();
            }
        }

        function openHint() {
            renderHintChart();
            hintPanel.classList.remove('hidden');
            gameArea.classList.replace('col-span-3', 'col-span-2');
            gameLayout.classList.add('grid-cols-3');
            gameLayout.classList.remove('justify-center');
        }

        function closeHint() {
            hintPanel.classList.add('hidden');
            gameArea.classList.replace('col-span-2', 'col-span-3');
            gameLayout.classList.remove('grid-cols-3');
            gameLayout.classList.add('justify-center');
        }

        function renderHintChart() {
            hintChart.innerHTML = '';
            hintTitle.textContent = `B·∫£ng ch·ªØ c√°i ${currentSyllabaryName === 'hiragana' ? 'Hiragana' : 'Katakana'}`;
            
            const kanaToRomajiMap = new Map(currentSyllabaryData.map(item => [item.kana, item.romaji]));
            const layout = GOJUON_LAYOUT[currentSyllabaryName];

            const createSection = (title, charLayout) => {
                const sectionWrapper = document.createElement('div');
                
                if (title) {
                    const sectionTitle = document.createElement('h4');
                    sectionTitle.className = 'font-bold text-md mb-2 text-center text-slate-600';
                    sectionTitle.textContent = title;
                    sectionWrapper.appendChild(sectionTitle);
                }

                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-5 gap-2 text-center';
                
                charLayout.flat().forEach(kana => {
                    const cell = document.createElement('div');
                    cell.className = 'p-1 bg-slate-100 rounded min-h-[50px] flex flex-col justify-center items-center';
                    
                    if (kana && kanaToRomajiMap.has(kana)) {
                        cell.innerHTML = `
                            <div class="font-bold text-lg">${kana}</div>
                            <div class="text-xs text-slate-500">${kanaToRomajiMap.get(kana)}</div>
                        `;
                    } else {
                        cell.className += ' bg-slate-50'; // √î tr·ªëng
                    }
                    grid.appendChild(cell);
                });
                sectionWrapper.appendChild(grid);
                return sectionWrapper;
            };

            // Render c√°c ph·∫ßn
            hintChart.appendChild(createSection('B·∫£ng ch√≠nh (Gojuon)', layout.main));
            hintChart.appendChild(createSection('√Çm ƒë·ª•c (Dakuten)', layout.dakuten));
            hintChart.appendChild(createSection('√Çm b√°n ƒë·ª•c (Handakuten)', layout.handakuten));
        }
        
        // --- EVENT LISTENERS ---
        hintButton.addEventListener('click', toggleHint);
        backButton.addEventListener('click', backToMenu);

    </script>
</body>
</html>